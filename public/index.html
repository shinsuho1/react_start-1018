<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>React App</title>
  <script type="text/javascript"
    src="//dapi.kakao.com/v2/maps/sdk.js?appkey=	a34202fd3240869d37623fa485b0a265"></script>

</head>

<body>
  <div id="root"></div>
  <div class="defaults">검색봇이 SEO를 위해서 읽도록하는 텍스트데이터를 작성하는 곳 입니다</div>
  <div class="mask">로딩중... 혹은 이미지 등으로 로딩을 표현하는 곳입니다</div>
  <script>
    const defaults = document.querySelector(".defaults");
    const mask = document.querySelector(".mask");
    let tags = "";
    const baseURL = "https://shinsuho1.github.io/react_start-1018";
    const imgs = [
      baseURL + "/img/Community.jpg",
      baseURL + "/img/Department.jpg",
      baseURL + "/img/Gallery.jpg",
      baseURL + "/img/Location.jpg",
      baseURL + "/img/Youtube.jpg",
      baseURL + "/img/Members.jpg",
    ]
    const vids = [
      baseURL + "/img/vid.mp4"
    ]
    createDOM();
    function createDOM() {
      imgs.forEach(el => {
        tags += `<img src=${el} />`
      });
      vids.forEach(el => {
        tags += `<video src=${el} loop muted autoPlay><video>`
      });
      defaults.innerHTML = tags;
    }

    //Promise.all()프로미스객체를 반환할때까지 기다린 후, 리졸브 트루가 반환되면 이후 동기화처리하는 함수

    let lenImg = imgs.length;
    let lenVid = vids.length;
    function loadImg() {
      return new Promise((resolve, reject) => {
        let countImg = 0;
        const imgDOM = defaults.querySelectorAll("img");

        imgDOM.forEach((el) => {
          el.onload = () => {
            countImg++;
            if (countImg === lenImg) {
              resolve(true);
            }
          }
        });
      });
    }
    function loadVid() {
      return new Promise((resolve, reject) => {
        let countVid = 0;
        const vidDOM = defaults.querySelectorAll("video");

        vidDOM.forEach((el) => {
          el.onload = () => {
            countVid++;
            if (countVid === lenVid) {
              resolve(true);
            }
          }
        });
      });
    }
    Promise.all([loadImg(), loadVid()]).then(result => {
      const [loadImg, loadVid] = result;
      console.log(result);
    });
  </script>
</body>

</html>

<!-- 
 현재 비디오를 기존의 방식대로 넣게되면 검은색 배경, 혹은 이미지가 잠시 보이는 등으로 구현됩니다
 구현방법 1. 웹 서버에 업로드하고(예: 구글드라이브) url을 받아서 src에 url을 첨부하는 방법
 구현방법 2. 강제로 비디오와 큰 이미들을 먼저 캐싱하도록 index.html에 DOM요소를 넣는 방법

 -->